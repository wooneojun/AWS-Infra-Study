# ️ AWS 백업 및 복구 (Backup & Restore) 전략 상세 가이드

가장 경제적이면서도 확실한 데이터 보존 방법인 **'백업 및 복구'** 전략의 핵심 메커니즘과 자동화 구현 단계를 정리합니다.

---

## 1. 백업 및 복원 전략 개요

| 구분 | 내용 |
| --- | --- |
| **장점** | 구현이 매우 쉽고 유지 비용이 가장 저렴함 |
| **단점** | 재해 발생 후 인프라를 새로 구축하므로 RTO/RPO가 상대적으로 김 |
| **적정 케이스** | 24시간 실시간 복구가 필수가 아닌 일반적인 비즈니스 워크로드 |

### 1.1. 데이터 보호 및 복제 전략

* **단일 리전 내 백업:** Multi-AZ 설정을 통해 가용성을 높이지만, 소프트웨어 결함이나 인적 오류(데이터 오염)에는 취약할 수 있습니다.
* **해결책:** `S3 버전 관리`, `DynamoDB PITR(Point-in-Time Recovery)` 등을 활용해 특정 시점으로 복구.


* **멀티 리전 백업:** **AWS Backup**을 사용하여 중앙 집중식으로 관리하며, 리전 간 복제를 통해 지역 재난에 대비합니다.
* **Tip:** 원본 리전과 백업 리전의 계정(Account)을 분리하면 보안성과 독립성이 더욱 높아집니다.



---

## 2. 핵심 구현 3단계 (자동화 프로세스)

재해 발생 시 사람이 개입하면 시간이 지체됩니다. **탐지-복구-전환**의 전 과정을 자동화하는 것이 핵심입니다.

### 2.1. 장애 발생 감지 (Detection)

시스템의 이상 징후를 실시간으로 포착합니다.

* **Amazon CloudWatch:** 메트릭 기반 알람 및 **Anomaly Detection(이상 탐지)** 기능을 통해 비정상적인 지표를 자동으로 탐지합니다.
* **AWS Health Dashboard:** AWS 인프라 자체의 장애 정보를 수신합니다.

**S3 API 에러 감지를 위한 EventBridge 패턴 예시:**

```json
{
  "source": ["aws.health"],
  "detail-type": ["AWS Health Event"],
  "detail": {
    "service": ["S3"],
    "eventTypeCategory": ["issue"],
    "eventTypeCode": [
      "AWS_S3_INCREASED_GET_API_ERROR_RATES", 
      "AWS_S3_INCREASED_PUT_API_ERROR_RATES"
    ]
  }
}

```

---

### 2.2. 시스템 및 데이터 복구 (Recovery)

재해 리전에 동일한 환경을 재구축하는 단계입니다.

1. **데이터 복구:** **AWS Backup**을 통해 타 리전에 복제된 백업본(EBS, RDS, S3 등)을 복원합니다.
2. **인프라 복구 (IaC):** **CloudFormation** 또는 **AWS CDK**를 사용하여 코드로 정의된 인프라를 즉시 배포합니다.
3. **골든 이미지 (AMI):** 필요한 소프트웨어가 미리 설치된 AMI를 복구 리전에도 즉시 사용할 수 있도록 준비해 둡니다.

---

### 2.3. 장애 조치 및 연결 (Failover & Integration)

복구된 리소스를 유기적으로 연결하고 트래픽을 전환합니다.

* **자동 리소스 연결:** * **Lambda:** 복구된 EBS 볼륨의 태그 정보를 읽어 새 EC2 인스턴스에 자동으로 마운트합니다.
* **SSM Runbook:** 복잡한 스크립트 실행이나 EFS/FSx 파일 시스템 연결을 자동화합니다.


* **워크플로 관리:** **AWS Step Functions**를 사용하여 [인프라 생성 → 데이터 복원 → 서버 연결]의 전 과정을 하나의 상태 머신으로 관리합니다.

---

## 3. 복구 속도를 높이는 자동화 팁

### 이벤트 기반 자동 연결

* **메커니즘:** "EBS 복구 완료" 이벤트를 **EventBridge**가 수신 → **Lambda** 호출 → 서버에 볼륨 자동 마운트.
* **효과:** 사람이 콘솔에 접속해 수동으로 연결하는 시간을 획기적으로 단축합니다.

### Step Functions 기반 오케스트레이션

복구 프로세스는 순서가 중요합니다. Step Functions를 쓰면 장애 발생 시 각 단계의 성공 여부를 추적하고 실패 시 재시도 로직을 태울 수 있어 복구 신뢰도가 높아집니다.