# [Case Study] 삼성계정: 2.7M RPS 환경에서의 무중단 EKS 업그레이드 전략

## 1. 개요

삼성계정은 전 세계 17억 명 이상의 사용자가 이용하며 모바일, TV, 가전 등 다양한 기기의 인증을 담당하는 글로벌 서비스입니다. 70여 개의 마이크로서비스(MSA)가 4개 리전에서 운영되고 있으며, 시스템 업그레이드 시에도 서비스 중단이 절대 용납되지 않는 환경입니다.

## 2. 당면 과제: 매니지드 서비스의 수명 주기

AWS EKS나 AuroraDB와 같은 매니지드 서비스는 일정 기간(약 1.5~2년)이 지나면 지원이 종료되므로 강제적인 업그레이드가 필요합니다.

### 업그레이드 제약 사항

* **인플레이스(In-place) 업그레이드의 위험성:** 컨트롤 플레인 업데이트 후 데이터 플레인(Worker Node)을 업데이트하는 방식은 호환성 이슈 발생 시 **롤백이 불가능**합니다.
* **검증의 어려움:** 수많은 마이크로서비스와 Add-on(CNI, CoreDNS 등) 간의 API 호환성을 사전에 100% 검증하기 어렵습니다.

---

## 3. 해결책: DNS 기반 Multi-Cluster 아키텍처

삼성계정 팀은 기존 클러스터를 유지한 채 신규 버전의 클러스터를 별도로 구축하여 트래픽을 점진적으로 전환하는 **Blue-Green 방식의 Multi-Cluster 아키텍처**를 선택했습니다.

### 3.1. DNS 기반 트래픽 전환 전략

대규모 트래픽 처리를 위해 프록시 서버 대신 DNS 레코드 제어 방식을 사용했습니다.

* **도메인 계층화:** 최상위 도메인 하위에 각 리전별 도메인을 두고, 그 아래에 기존(Old) 클러스터와 신규(New) 클러스터용 내부 도메인을 생성합니다.
* **가중치 기반 라우팅 (Route 53 Weighted Records):**
1. 신규 클러스터에 서비스를 배포하고 검증을 완료합니다.
2. Route 53에서 신규 클러스터로 향하는 가중치를 0에서 점진적으로 높입니다 (예: 1% -> 10% -> 50% -> 100%).
3. 모니터링 중 이슈 발생 시 즉시 가중치를 0으로 돌려 **안전하게 롤백**합니다.



---

## 4. 기술적 이슈 및 최적화

### 4.1. DNS 전파(Propagation) 지연 해결

일반적으로 DNS는 캐싱으로 인해 전환이 느리다고 알려져 있으나, 삼성계정 사례에서는 가중치 조절 시 **5분 이내에 99.9%의 트래픽이 즉시 전환**되는 것을 확인하여 실효성을 입증했습니다.

### 4.2. IP 리소스 고갈 문제 (IP Exhaustion)

신구 클러스터를 동시에 운영하면 두 배의 노드와 Pod가 생성되므로 서브넷 내의 내부 IP가 부족해지는 현상이 발생했습니다.

* **해결책:** EKS 노드를 고사양으로 스케일 업(Scale-up)하여 노드당 수용 가능한 Pod 수를 늘림으로써, kubelet이나 필수 Add-on Pod의 총개수를 약 1,000개 이상 줄여 IP 리소스를 확보했습니다.

---

## 5. 핵심 요약 및 시사점

| 항목 | 상세 내용 |
| --- | --- |
| **인프라 규모** | 4개 리전, 70+ MSA, 2.7M RPS, 200K TPS |
| **핵심 기술** | AWS EKS, Route 53 Weighted Routing, VPC Peering |
| **성공 요인** | 롤백이 가능한 Multi-Cluster 환경 구축 및 점진적 트래픽 전환 |
| **교훈** | 매니지드 서비스 업그레이드는 단순 기능 업데이트가 아닌 인프라 전체의 가용성 확보 전략이 핵심임 |