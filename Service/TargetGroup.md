# [Networking] AWS 대상 그룹(Target Group) 설정 가이드

## 1. 대상 그룹(Target Group)의 핵심 개념

대상 그룹은 로드 밸런서가 수신한 트래픽을 전달할 **최종 목적지들의 논리적 집합**입니다. 단순한 서버 리스트를 넘어, 통신 규약(프로토콜)과 대상의 건전성을 확인하는 규칙(상태 검사)을 포함하는 운영 단위입니다.

---

## 2. 대상 유형(Target Type)별 상세 분석

대상 유형은 대상 그룹 생성 시 가장 먼저 결정해야 하며, **생성 후에는 변경이 불가능**합니다.

### ① 인스턴스 (Instance)

* **작동 방식:** EC2 인스턴스 ID를 기반으로 대상을 지정하며, 인스턴스의 기본 프라이빗 IP로 트래픽을 전달합니다.
* **장점:** **Auto Scaling 그룹과 네이티브하게 연동**되어 서버의 증설/감소에 따라 대상 목록이 자동 갱신됩니다.
* **적합한 상황:** 표준적인 EC2 기반 웹 애플리케이션 운영 시.

### ② IP 주소 (IP Address)

* **작동 방식:** 특정 IP 주소를 직접 등록합니다. VPC 내부뿐만 아니라 VPN/Direct Connect로 연결된 **온프레미스 서버**도 등록 가능합니다.
* **장점:** 하이브리드 클라우드 환경이나 마이크로서비스 간의 유연한 IP 기반 연결을 지원합니다.
* **주의:** 루프백(127.0.0.1)이나 공인 IP는 등록할 수 없습니다.

### ③ Lambda 함수 (Lambda)

* **작동 방식:** 요청이 들어오면 특정 Lambda 코드를 호출(Invoke)합니다. 포트나 프로토콜 개념이 없습니다.
* **제약 사항:** **ALB(Application Load Balancer)**에서만 지원하며, 상태 검사 항목이 간소화됩니다.
* **적합한 상황:** 서버리스 아키텍처 기반의 API 및 이벤트 처리.

### ④ Application Load Balancer (ALB)

* **작동 방식:** NLB의 대상으로 다른 ALB를 지정합니다.
* **장점:** **NLB의 고정 IP(Static IP)**가 필요하면서도 **ALB의 정교한 L7 라우팅** 기능(URL 경로 기반 등)을 동시에 쓰고 싶을 때 사용합니다.
* **제약 사항:** NLB에서만 설정 가능한 타겟 유형입니다.

---

## 3. 주요 설정 항목 및 상태 검사(Health Check)

### 3.1 설정 항목 가이드

| 항목 | 설명 | 비고 |
| --- | --- | --- |
| **프로토콜** | LB와 대상 간 통신 규약 (HTTP, HTTPS, TCP, GENEVE 등) | GWLB는 항상 GENEVE 사용 |
| **포트** | 대상 서버가 요청을 대기하는 포트 번호 (1-65535) | Lambda 유형 시 제외 |
| **프로토콜 버전** | HTTP1, HTTP2, gRPC 중 서비스 최적값 선택 | 성능 및 통신 효율 결정 |

### 3.2 상태 검사(Health Check) 메커니즘

로드 밸런서의 가용성을 유지하는 핵심 자동화 기능입니다.

* **검사 경로(Path):** 상태 확인을 수행할 엔드포인트 (예: `/health`, `/status`).
* **정상/비정상 임계값:** '정상' 또는 '장애'로 판단하기 위해 필요한 연속 성공/실패 횟수.
* **간격(Interval):** 상태 확인 패킷을 보내는 주기 (기본 30초).
* **제한 시간(Timeout):** 응답이 오지 않을 때 실패로 간주하기까지 기다리는 시간.

---

## 요약: 상황별 대상 유형 선택 가이드

| 서비스 유형 | 추천 대상 유형 |
| --- | --- |
| **일반적인 웹 서비스 (EC2)** | **인스턴스 (Instance)** |
| **온프레미스 서버/하이브리드** | **IP 주소 (IP Address)** |
| **서버리스 API / 이벤트 처리** | **Lambda 함수** |
| **고정 IP 기반 L7 서비스** | **Application Load Balancer (ALB)** |
| **보안 어플라이언스 (GWLB)** | **인스턴스 또는 IP 주소** |