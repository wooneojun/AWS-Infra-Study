# [Architecture] AI 기반 마이크로서비스 장애 진단 및 해결 자동화 설계

## 1. 배경 및 문제점

마이크로서비스 아키텍처(MSA)는 확장성이 뛰어나지만, 분산된 특성으로 인해 장애 조치가 어렵습니다.

* **복잡성:** 로그, 메트릭, 이벤트가 여러 레이어에 산재하여 장애 지점 파악이 난해함.
* **지식 격차:** 클라우드 네이티브 환경에 대한 숙련도 부족이 관측성의 큰 장애물로 작용.
* **MTTR(평균복구시간) 증가:** 운영팀과 개발팀 간 정보 격차로 이슈 해결에 평균 1시간 이상 소요.

---

## 2. 주요 솔루션 아키텍처

### 2.1 RAG(검색 증강 생성) 기반 챗봇

전통적인 데이터 검색 및 답변 방식으로, 텔레메트리 데이터를 LLM과 결합하여 진단을 수행합니다.

* **데이터 수집:** Fluent Bit을 통해 로그/이벤트를 Amazon Kinesis로 스트리밍.
* **벡터화:** AWS Lambda와 Amazon Bedrock을 사용해 데이터를 벡터 임베딩으로 변환.
* **저장 및 검색:** Amazon OpenSearch Serverless에 저장된 벡터 데이터를 기반으로 유사 사례 검색 및 해결책 제안.

### 2.2 지능형 멀티 에이전트 시스템 (Strands/MCP)

자율적인 AI 에이전트들이 도구를 직접 사용해 문제를 진단하고 자동화된 조치를 수행합니다.

* **Orchestrator Agent:** 전체 문제 해결 워크플로 조율.
* **K8s Specialist Agent:** MCP(Model Context Protocol)를 통해 EKS API에 직접 접근하여 실시간 클러스터 진단 수행.
* **인터페이스:** Slack 등 협업 도구와 통합하여 실시간 대화형 대응 가능.

---

## 3. 관측성 데이터 파이프라인 (Pipeline)

성능 향상과 비용 효율성을 위해 서버리스 기반의 견고한 파이프라인을 구축합니다.

1. **데이터 집계:** Fluent Bit이 K8s 노드의 원격 측정 데이터(앱 로그, Kubelet 로그 등)를 캡처하여 **Kinesis Data Streams**로 전송.
2. **정규화 및 임베딩:** **AWS Lambda**가 배치 처리(Batch Processing) 방식으로 데이터를 정규화하고, **Amazon Bedrock**을 통해 의미적 이해가 가능한 숫자 좌표(벡터 임베딩)로 변환.
3. **서버리스 저장소:** **OpenSearch Serverless**를 사용해 인프라 관리 오버헤드 없이 고성능 벡터 검색 환경 유지.

---

## 4. 장애 조치 워크플로 (Iterative Process)

AI 어시스턴트는 다음과 같은 반복적인 과정을 통해 해결책을 도출합니다.

1. **질문 입력:** 사용자가 장애 현상을 질문 (예: "Pod가 Pending 상태인 이유 분석해줘").
2. **데이터 증강:** 챗봇이 OpenSearch에서 유사한 로그 데이터를 검색하여 프롬프트에 추가.
3. **명령 제안:** LLM이 진단을 위한 `kubectl` 명령 목록 생성 및 제안.
4. **명령 실행:** 읽기 전용 권한을 가진 도우미가 클러스터에서 명령을 실행하고 결과를 LLM에 반환.
5. **최종 보고:** 수집된 모든 정보를 종합하여 최종 해결 방법 및 원인 보고서 작성.

---

## 5. 보안 및 가드레일 (Security)

AI 에이전트의 자율성이 높은 만큼 강력한 보안 설정이 필수적입니다.

* **최소 권한 원칙(PoLP):** 진단 어시스턴트는 읽기 전용(`ReadOnly`) 권한만 부여하며, 특정 네임스페이스로 접근 제한.
* **데이터 보호:** 임베딩 생성 전 개인정보 및 민감 데이터 마스킹 처리, AWS KMS를 통한 데이터 암호화.
* **네트워크 보안:** VPC 엔드포인트를 사용해 모든 구성 요소를 프라이빗 서브넷 내에 배치하여 외부 노출 최소화.
* **프롬프트 가드레일:** 인젝션 공격 방지를 위한 입력값 검증 및 AI 동작 제어.

---

## 6. 결론 및 인사이트

* **Self-Service 진단:** 모든 팀원이 전문가 수준의 K8s 진단 능력을 갖출 수 있어 조직 전체의 운영 효율 향상.
* **운영 부담 최적화:** 서버리스 아키텍처를 채택하여 인프라 관리보다 문제 해결 및 비즈니스 로직에 집중 가능.
* **신속한 복구:** 대화형 인터페이스와 실시간 데이터 결합을 통해 장애 인지부터 복구까지의 시간(MTTR)을 획기적으로 단축.