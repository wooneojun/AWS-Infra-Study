## 1. NLB의 핵심 동작 원리 (How it Works)

NLB는 OSI 7계층 중 4계층(전송 계층)에서 동작하며, 매우 높은 처리량과 낮은 지연 시간이 특징입니다.

1. **요청 수신:** 클라이언트가 애플리케이션(DNS 이름 또는 IP)으로 요청을 보냅니다.
2. **진입점 처리:** 로드 밸런서는 인터넷 경계(Public) 또는 PrivateLink 엔드포인트를 통해 이 요청을 수신합니다.
3. **리스너(Listener) 검사:** 리스너는 설정된 **프로토콜(TCP/UDP/TLS)**과 **포트**를 보고 들어온 요청이 규칙에 맞는지 검사합니다.
    - *TLS 오프로드:* 만약 TLS 리스너를 사용 중이라면, 암호화된 트래픽을 NLB에서 복호화하여 대상 서버로 보냄으로써 서버의 연산 부담을 줄여줍니다.
4. **라우팅 및 대상 선택:** 리스너 규칙에 따라 **대상 그룹(Target Group)**으로 요청을 라우팅합니다.
5. **흐름 해시(Flow Hash) 알고리즘:** NLB는 프로토콜, 원본 IP/포트, 대상 IP/포트 등을 조합한 '흐름 해시'를 사용하여 대상 그룹 내의 정상적인 인스턴스 하나를 선택해 연결을 고정합니다.

---

## 2. 기본 구성 (Basic Configuration)

- **로드 밸런서 이름:** 계정 내 고유 이름입니다.
    - 최대 32자의 영숫자와 하이퍼스레딩(-)을 사용하되, 시작과 끝에 하이퍼스레딩을 쓸 수 없습니다.
    - **생성 후 변경이 불가능합니다.**
- **체계 (Scheme):** 트래픽이 어디서 오는지에 따라 결정하며, **생성 후 변경이 불가능합니다.**
    - **인터넷 경계 (Internet-facing):** 외부 인터넷 사용자의 요청을 처리하며 퍼블릭 IP를 가집니다. 퍼블릭 서브넷이 반드시 필요합니다.
    - **내부 (Internal):** VPC 내부의 프라이빗 IP만 가지며 내부 서비스 간의 통신에 사용됩니다.
- **IP 주소 유형:** * **IPv4:** 전형적인 IPv4 주소만 사용합니다.
    - **듀얼 스택 (Dualstack):** IPv4와 IPv6 주소를 모두 지원합니다.

---

## 3. 네트워크 및 보안 설정

### **네트워크 매핑 (Network Mapping)**

- **VPC:** 로드 밸런서가 존재하고 확장될 네트워크 공간입니다.
- **가용 영역(AZ) 및 서브넷:** 최소 하나 이상의 AZ를 선택해야 합니다. 여러 개를 선택하면 특정 AZ에 장애가 발생해도 서비스가 유지되는 **내결함성**이 향상됩니다.

### **보안 그룹 (Security Groups)**

- **역할:** 로드 밸런서에 드나드는 트래픽을 제어하는 방화벽입니다.
- **특징:** 생성 시 하나 이상의 보안 그룹을 지정해야 보안 그룹 지원이 활성화됩니다.
- **주의사항:** NLB의 보안 그룹은 리스너 포트와 상태 확인(Health Check) 포트 모두에서 대상 서버와 통신이 가능하도록 규칙이 설정되어야 합니다.

---

## 4. 리스너 및 라우팅 상세 (Listeners & Routing)

- **리스너 구성:** 특정 포트(1~65535)와 프로토콜(TCP)을 감시합니다.
- **대상 그룹으로 전달:**
    - **가중치:** 여러 대상 그룹으로 트래픽을 보낼 때 0~999 사이의 값으로 비율을 조정합니다 (기본 100%).
- **대상 그룹 고정성 (Stickiness):** * 이 옵션을 켜면 특정 사용자 세션을 특정 대상 그룹에 바인딩합니다. (개별 인스턴스에 고정하려면 대상 그룹 속성에서 별도로 설정해야 합니다.)

---

## 5. 추가 최적화 및 검토 (Optimization)

- **AWS Global Accelerator:** 전 세계 사용자에게 더 빠른 경로를 제공하기 위해 2개의 글로벌 고정 IP를 할당받아 성능과 가용성을 최적화합니다. (추가 요금 발생)
- **태그 (Tags):** 관리 편의를 위해 'Key: Value' 형태로 리소스를 분류합니다.
- **검토 및 요약:** 생성 전 이름, 체계, VPC, 리스너 설정을 최종 확인합니다. 비용 예상치를 통해 월별 예상 지출을 미리 파악할 수 있습니다.